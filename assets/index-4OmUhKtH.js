var Ve=Object.defineProperty;var Oe=(o,t,e)=>t in o?Ve(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var l=(o,t,e)=>Oe(o,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const Re="http://www.w3.org/2000/svg",j=o=>document.createElementNS(Re,o),oe=(o,t,e,s)=>Math.sqrt(Math.pow(o-e,2)+Math.pow(t-s,2)),ye=(o,t)=>oe(o.getX(),o.getY(),t.getX(),t.getY());class He{constructor(t,e){l(this,"width");l(this,"height");l(this,"elem");this.width=t,this.height=e;const s=j("svg");s.setAttribute("version","1.1"),s.setAttribute("width",this.width.toString()),s.setAttribute("height",this.height.toString()),s.setAttribute("viewBox",`-${this.width/2} -${this.height/2} ${this.width} ${this.height}`),globalThis.coorCenterX=this.width/2,globalThis.coorCenterY=this.height/2,this.elem=s}appendChild(t){this.elem.appendChild(t.getElem())}getElem(){return this.elem}setWidth(t){this.width=t,this.elem.setAttribute("width",this.width.toString())}setHeight(t){this.height=t,this.elem.setAttribute("height",this.height.toString())}}const $=class ${constructor(){l(this,"elems");this.elems=[]}static getInstance(){return $.instance||($.instance=new $),$.instance}push(t){this.elems.push(t)}find(t,e){for(let s=0;s<this.elems.length;s++){const i=this.elems[s];if(i.getIsShow()&&i.isClick(t,e))return i}return null}};l($,"instance");let g=$;const V=class V{constructor(){l(this,"elems");this.elems=[]}static getInstance(){return V.instance||(V.instance=new V),V.instance}push(t){this.elems.push(t)}find(t,e){for(let s=0;s<this.elems.length;s++){const i=this.elems[s];if(i.getIsShow()&&i.isClick(t,e))return i}return null}};l(V,"instance");let Q=V;var b=(o=>(o[o.Point=0]="Point",o[o.Curve=1]="Curve",o))(b||{});const Ke=o=>{const t=o.split("_");if(t.length<2)return[o,0];const e=t[0],s=t.pop();return s==null?[o,0]:isNaN(parseFloat(s))?[e,0]:[e,parseFloat(s)]},ze=(o,t)=>{if(o.length>1)return!1;const e=o.charCodeAt(0);return t==b.Point?e>64&&e<91:t==b.Curve?e>96&&e<123:!1},Je=(o,t,e,s)=>t>s?1:t<s?-1:o.charCodeAt(0)>e.charCodeAt(0)?1:o.charCodeAt(0)<e.charCodeAt(0)?-1:0,Pe=(o,t)=>t==0?o:o+"_"+t,Xe=(o,t,e)=>{e==b.Point?(globalThis.nextPointLabelChar=o,globalThis.nextPointLabelNum=t):e==b.Curve&&(globalThis.nextCurveLabelChar=o,globalThis.nextCurveLabelNum=t)},Me=o=>{let t=globalThis.nextPointLabelChar,e=globalThis.nextPointLabelNum,s="",i="";if(o==b.Point)s="Z",i="A";else if(o==b.Curve)s="z",i="a";else return["",0];let n=t,a=e;t==s?(n=i,a=e+1):n=String.fromCharCode(t.charCodeAt(0)+1);const c=Ze(o);if(c.length>0){const u=Je(n,a,c[0][0],c[0][1]);u==1?(t=c[0][0],e=c[0][1]):Xe(n,a,o),u!=-1&&c.shift()}else Xe(n,a,o);return[t,e]},Ue=()=>globalThis.nextId++,qe=(o,t,e)=>{if(o.length==0){o.push([t,e]);return}for(let s=0;s<o.length;s++)if(!(o[s][1]<e)&&!(o[s][0].charCodeAt(0)<t.charCodeAt(0))){o.splice(s,0,[t,e]);return}},Ze=o=>o==b.Point?globalThis.unusedPointLabels:o==b.Curve?globalThis.unusedCurveLabels:[],je=(o,t)=>{const[e,s]=Ke(o);ze(e,t)&&(t==b.Point?qe(globalThis.unusedPointLabels,e,s):t==b.Curve&&qe(globalThis.unusedCurveLabels,e,s))},O=class O{constructor(t){l(this,"mapElem");l(this,"mapLabel");l(this,"selectedElem");l(this,"svgElem");this.mapElem=new Map,this.mapLabel=new Map,this.selectedElem=null,this.svgElem=t}static getInstance(t){return O.instance||(O.instance=new O(t)),O.instance}appendChild(t){this.svgElem.appendChild(t)}set(t,e){this.mapElem.set(t,e)}get(t){const e=this.mapElem.get(t);return e||null}setLabel(t,e){this.mapLabel.set(t,e)}getByLabel(t){const e=this.mapLabel.get(t);return e?this.get(e):null}select(t){t instanceof U&&(this.selectedElem!=null&&this.selectedElem.unchoose(),this.selectedElem=t,this.selectedElem.choose())}unselect(){this.selectedElem!=null&&(this.selectedElem.unchoose(),this.selectedElem=null)}getSelectedElem(){return this.selectedElem}changeLabel(t,e){const s=this.mapLabel.get(e);if(s!=null){const i=this.mapElem.get(s);if(i!=null&&i instanceof I){const[n,a]=Me(i.getElemType());let c=Pe(n,a);i.removeLabel(),i.setLabel(c),this.mapLabel.set(c,s)}}t.setLabel(e),this.mapLabel.set(e,t.getId())}};l(O,"instance");let h=O;class U{constructor(t){l(this,"elem");l(this,"id");l(this,"deprecated");l(this,"isShowTrack");this.elem=t,this.id=Ue(),this.deprecated=!1,this.isShowTrack=!1,h.instance.set(this.id,this),h.instance.appendChild(this.elem)}getElem(){return this.elem}getId(){return this.id}remove(){this.elem.remove()}unchoose(){}choose(){}hide(){}show(){}onmousedown(t){}onmousemove(t){}showTrack(){this.isShowTrack=!0}unshowTrack(){this.isShowTrack=!1}}class I extends U{constructor(e,s,i,n,a,c){super(e);l(this,"labelElem");l(this,"label");l(this,"relativeX");l(this,"relativeY");l(this,"isLabelShow");l(this,"labelStroke");l(this,"labelFill");l(this,"elemType");l(this,"deprecatedLabel");if(this.relativeX=5,this.relativeY=5,this.elemType=c,this.deprecatedLabel=!1,n==null){const[d,w]=Me(this.elemType);this.label=Pe(d,w)}else this.label=n;this.isLabelShow=a,this.labelStroke="red",this.labelFill="red",h.instance.setLabel(this.label,this.id);const u=j("text");u.setAttribute("x",(s+this.relativeX).toString()),u.setAttribute("y",(i+this.relativeY).toString()),u.classList.add("cursor-pointer","user-select-none"),u.innerHTML=this.label,this.isLabelShow||u.setAttribute("opacity","0"),u.setAttribute("stroke",this.labelStroke),u.setAttribute("fill",this.labelFill),this.labelElem=u,h.instance.appendChild(this.labelElem)}showLabel(){this.isLabelShow||(this.isLabelShow=!0,this.labelElem.setAttribute("opacity","1"))}hideLabel(){this.isLabelShow&&(this.isLabelShow=!1,this.labelElem.setAttribute("opacity","0"))}reverseLabel(){this.deprecatedLabel||(this.deprecatedLabel=!0,this.labelElem.setAttribute("opacity","0"))}backwardLabel(){this.deprecatedLabel&&(this.deprecatedLabel=!1,this.labelElem.setAttribute("opacity","1"))}setLabelParentX(e){this.labelElem.setAttribute("x",(e+this.relativeX).toString())}setLabelParentY(e){this.labelElem.setAttribute("y",(e+this.relativeY).toString())}getLabel(){return this.label}setLabel(e){this.label=e,this.labelElem.innerHTML=this.label}getElemType(){return this.elemType}setLabelStroke(e){this.labelStroke=e,this.labelElem.setAttribute("stroke",this.labelStroke)}setLabelFill(e){this.labelFill=e,this.labelElem.setAttribute("fill",this.labelFill)}setLabelStyle(e){e.fill!=null&&this.setLabelFill(e.fill),e.stroke!=null&&this.setLabelStroke(e.stroke)}removeLabel(){je(this.label,this.elemType)}}class se extends I{constructor(e,s,i,n,a,c,u,d){super(e,n,a,c,u,d);l(this,"stroke");l(this,"strokeWidth");l(this,"equation");l(this,"isShow");l(this,"onMoveCallbacks");this.isShow=!0,this.equation=s,this.stroke=i,this.strokeWidth=1,this.elem.setAttribute("stroke",this.stroke),this.elem.setAttribute("stroke-width",this.strokeWidth.toString()),this.elem.setAttribute("fill","transparent"),this.elem.classList.add("cursor-pointer"),this.onMoveCallbacks=[],Q.instance.push(this)}setStroke(e){this.stroke=e,this.elem.setAttribute("stroke",this.stroke)}setStyle(e){e.stroke!=null&&this.setStroke(e.stroke)}hide(){this.isShow&&(this.elem.setAttribute("stroke-opacity","0"),this.isShow=!1,this.hideLabel())}show(){this.isShow||(this.elem.setAttribute("stroke-opacity","1"),this.isShow=!0,this.showLabel())}getIsShow(){return this.isShow}isClick(e,s){return this.equation.distance(e,s)<=9}choose(){this.elem.setAttribute("stroke-width",(this.strokeWidth*2).toString())}unchoose(){this.elem.setAttribute("stroke-width",this.strokeWidth.toString())}getFoot(e,s){return[e,s]}updateEquation(){}onMove(e){this.onMoveCallbacks.push(e)}}class f{constructor(){}execute(t){}onmousedown(t){}onmousemove(t){}onmouseup(t){}onleave(){}}const Qe=(o,t)=>[o-globalThis.mainLeftMargin-globalThis.coorCenterX,t-globalThis.coorCenterY],p=o=>Qe(o.clientX,o.clientY),A=class A extends f{constructor(){super();l(this,"isMouseDown");this.isMouseDown=!1}static getInstance(){return A.instance||(A.instance=new A,r.instance.set("mouse",A.instance)),A.instance}execute(e){}onmousedown(e){this.isMouseDown=!0;const[s,i]=p(e);let n=g.instance.find(s,i);if(n!=null){h.instance.select(n);return}let a=Q.instance.find(s,i);if(a!=null){h.instance.select(a);return}h.instance.unselect()}onmousemove(e){if(this.isMouseDown){const s=h.instance.getSelectedElem();s!=null&&s.onmousemove(e)}}onmouseup(e){this.isMouseDown=!1}};l(A,"instance");let _=A;const R=class R{constructor(){l(this,"map");l(this,"currentCommand");l(this,"commandNames");this.map=new Map,this.currentCommand=_.instance,this.commandNames=[]}static getInstance(){return R.instance||(R.instance=new R),R.instance}set(t,e){this.map.set(t,e),this.commandNames.push(t)}get(t){const e=this.map.get(t);return e||null}getCurrentCommand(){return this.currentCommand}setDefaultCommand(){this.currentCommand=_.instance}setCurrentCommand(t){this.currentCommand=t}search(t){return this.commandNames.filter(e=>e.toUpperCase().includes(t.toUpperCase()))}};l(R,"instance");let r=R;const x=class x extends f{constructor(){super()}static getInstance(){return x.instance||(x.instance=new x,r.instance.set("changeCurveStyle",x.instance)),x.instance}parseCurveStyle(t){return JSON.parse(t)}execute(t){if(t.length==2&&t[0]instanceof se&&typeof t[1]=="string")t[0].setStyle(this.parseCurveStyle(t[1]));else if(t.length==2&&typeof t[0]=="string"&&typeof t[1]=="string"){const e=h.instance.getByLabel(t[0]);e!=null&&e instanceof se&&e.setStyle(this.parseCurveStyle(t[1]))}}};l(x,"instance");let ae=x;const y=class y extends f{constructor(){super()}static getInstance(){return y.instance||(y.instance=new y,r.instance.set("changeLabel",y.instance)),y.instance}execute(t){if(t.length==2&&typeof t[0]=="string"&&typeof t[1]=="string"){if(!isNaN(parseFloat(t[1])))return;const e=h.instance.getByLabel(t[0]);e!=null&&e instanceof I&&h.instance.changeLabel(e,t[1])}else if(t.length==2&&t[0]instanceof I&&typeof t[1]=="string"){if(!isNaN(parseFloat(t[1])))return;h.instance.changeLabel(t[0],t[1])}}};l(y,"instance");let re=y;const X=class X extends f{constructor(){super()}static getInstance(){return X.instance||(X.instance=new X,r.instance.set("changeLabelStyle",X.instance)),X.instance}parseLabelStyle(t){return JSON.parse(t)}execute(t){if(t.length==2&&t[0]instanceof I&&typeof t[1]=="string")t[0].setLabelStyle(this.parseLabelStyle(t[1]));else if(t.length==2&&typeof t[0]=="string"&&typeof t[1]=="string"){const e=h.instance.getByLabel(t[0]);e!=null&&e instanceof I&&e.setLabelStyle(this.parseLabelStyle(t[1]))}}};l(X,"instance");let ce=X;class m extends I{constructor(e,s,i,n){const a="red",c="red",w=n.isGhost?n.isGhost:!1;let Z=!!(n.isShowLabel||n.isShowLabel==null);w&&(Z=!1,i="");const E=j("circle");E.setAttribute("cx",e.toString()),E.setAttribute("cy",s.toString()),E.setAttribute("r","5"),E.setAttribute("stroke",a),E.setAttribute("fill",c),E.classList.add("cursor-pointer");super(E,e,s,i,Z,b.Point);l(this,"x");l(this,"y");l(this,"r");l(this,"stroke");l(this,"fill");l(this,"onMoveCallbacks");l(this,"onLeaveCallbacks");l(this,"isShow");l(this,"isGhost");l(this,"isLock");this.isLock=!1,this.isShow=!0,this.isGhost=w,this.x=e,this.y=s,this.r=5,this.stroke=a,this.fill=c,this.onMoveCallbacks=[],this.onLeaveCallbacks=[],g.instance.push(this)}choose(){this.elem.setAttribute("r",(this.r*2).toString())}unchoose(){this.elem.setAttribute("r",this.r.toString())}hide(){this.isShow&&(this.elem.setAttribute("stroke-opacity","0"),this.elem.setAttribute("fill-opacity","0"),this.isShow=!1,this.hideLabel())}show(){this.isShow||(this.elem.setAttribute("stroke-opacity","1"),this.elem.setAttribute("fill-opacity","1"),this.isShow=!0,this.showLabel())}reverse(){this.deprecated||(this.deprecated=!0,this.elem.setAttribute("stroke-opacity","0"),this.elem.setAttribute("fill-opacity","0"),this.reverseLabel())}backward(){this.deprecated&&(this.deprecated=!1,this.elem.setAttribute("stroke-opacity","1"),this.elem.setAttribute("fill-opacity","1"),this.backwardLabel())}lock(){this.isLock=!0}unlock(){this.isLock=!1}getIsLock(){return this.isLock}getX(){return this.x}setX(e){this.x=e,this.elem.setAttribute("cx",e.toString())}getY(){return this.y}setY(e){this.y=e,this.elem.setAttribute("cy",e.toString())}getStroke(){return this.stroke}setStroke(e){this.stroke=e,this.elem.setAttribute("stroke",this.stroke)}getFill(){return this.fill}setFill(e){this.fill=e,this.elem.setAttribute("fill",this.fill)}getElem(){return this.elem}setR(e){this.r=e,this.elem.setAttribute("r",this.r.toString())}getR(){return this.r}getIsShow(){return this.isShow}setIsGhost(e){if(this.isGhost=e,this.isGhost)this.hide();else{const[s,i]=Me(this.elemType);this.setLabel(Pe(s,i)),this.show()}}remove(){if(this.removeLabel(),this.labelElem.remove(),this.elem.remove(),!this.isGhost)for(const e of this.onLeaveCallbacks)e()}isClick(e,s){return Math.abs(this.x-e)<=9&&Math.abs(this.y-s)<=9}move(e,s){if(this.x=e,this.y=s,this.elem.setAttribute("cx",this.x.toString()),this.elem.setAttribute("cy",this.y.toString()),this.setLabelParentX(this.x),this.setLabelParentY(this.y),this.isShowTrack){const i=j("circle");i.setAttribute("cx",e.toString()),i.setAttribute("cy",s.toString()),i.setAttribute("r",this.r.toString()),i.setAttribute("stroke",this.stroke),i.setAttribute("fill",this.fill),i.classList.add("track"),h.instance.appendChild(i)}for(const i of this.onMoveCallbacks)i(this)}onMove(e){this.onMoveCallbacks.push(e)}onmousedown(e){}onmousemove(e){this.isLock||this.move(globalThis.mouseX,globalThis.mouseY)}onLeaveCallback(e){this.onLeaveCallbacks.push(e)}setStyle(e){e.fill!=null&&this.setFill(e.fill),e.stroke!=null&&this.setStroke(e.stroke)}}const q=class q extends f{constructor(){super()}static getInstance(){return q.instance||(q.instance=new q,r.instance.set("changePointStyle",q.instance)),q.instance}parsePointStyle(t){return JSON.parse(t)}execute(t){if(t.length==2&&t[0]instanceof m&&typeof t[1]=="string")t[0].setStyle(this.parsePointStyle(t[1]));else if(t.length==2&&typeof t[0]=="string"&&typeof t[1]=="string"){const e=h.instance.getByLabel(t[0]);e!=null&&e instanceof m&&e.setStyle(this.parsePointStyle(t[1]))}}};l(q,"instance");let he=q;const Ye=(o,t,e,s)=>o==e?(i,n)=>i-o:(i,n)=>n-s-(t-s)*(i-e)/(o-e),Te=(o,t,e,s)=>o==e?(i,n)=>Math.abs(i-o):(i,n)=>Math.abs(n-s-(t-s)*(i-e)/(o-e))/Math.sqrt(1+Math.pow(t-s,2)/Math.pow(o-e,2)),Ne=(o,t,e,s)=>(i,n)=>Math.pow(i-o,2)+Math.pow(n-t,2)-Math.pow(e-o,2)-Math.pow(s-t,2),De=(o,t,e,s)=>(i,n)=>Math.abs(Math.sqrt(Math.pow(i-o,2)+Math.pow(n-t,2))-Math.sqrt(Math.pow(e-o,2)-Math.pow(s-t,2)));class We{constructor(t,e){l(this,"equation");l(this,"distanceEquation");this.equation=t,this.distanceEquation=e}isSolution(t,e){return this.equation(t,e)==0}distance(t,e){return this.distanceEquation(t,e)}setEquation(t){this.equation=t}setDistanceEquation(t){this.distanceEquation=t}}class _e extends We{constructor(e,s,i,n){const a=Ne(e,s,i,n),c=De(e,s,i,n);super(a,c);l(this,"k");l(this,"h");l(this,"r");this.h=e,this.k=s,this.r=Math.pow(i-e,2)+Math.pow(n-s,2)}getH(){return this.h}getK(){return this.k}getR(){return this.r}update(e,s,i,n){this.setEquation(Ne(e,s,i,n)),this.setDistanceEquation(De(e,s,i,n)),this.h=e,this.k=s,this.r=Math.pow(i-e,2)+Math.pow(n-s,2)}}class le extends se{constructor(e,s,i){const n=j("circle");n.setAttribute("cx",e.getX().toString()),n.setAttribute("cy",e.getY().toString()),n.setAttribute("r",ye(e,s).toString());const a=new _e(e.getX(),e.getY(),s.getX(),s.getY());super(n,a,"red",s.getX(),s.getY(),i,!1,b.Curve);l(this,"center");l(this,"p");l(this,"equation");this.equation=a,this.center=e,this.p=s,this.center.onMove(c=>{this.move(),this.updateEquation()}),this.center.onLeaveCallback(()=>{this.remove()}),this.p.onMove(c=>{this.move()}),this.p.onLeaveCallback(()=>{this.remove()}),this.elem=n}move(){this.elem.setAttribute("cx",this.center.getX().toString()),this.elem.setAttribute("cy",this.center.getY().toString()),this.elem.setAttribute("r",ye(this.center,this.p).toString());for(const e of this.onMoveCallbacks)e(this)}updateEquation(){this.equation.update(this.center.getX(),this.center.getY(),this.p.getX(),this.p.getY())}getElem(){return this.elem}getP(){return this.p}setP(e){this.p=e,this.move(),this.p.onMove(s=>{this.move()}),this.updateEquation()}remove(){this.removeLabel(),this.elem.remove()}onmousedown(e){}onmousemove(e){}getFoot(e,s){const i=this.equation.getK(),n=this.equation.getH(),a=this.equation.getR(),c=this.center.getX(),u=this.center.getY(),d=(u-s)/(c-e),w=s-(u-s)*e/(c-e),Z=2*d*w-2*i*d-2*n,E=d*d+1,Ie=Math.pow(Z,2)-4*E*(w*w-2*i*w+i*i+n*n-a),ie=(-Z+Math.sqrt(Ie))/(2*E),ne=(-Z-Math.sqrt(Ie))/(2*E),Ae=d*ie+w,xe=d*ne+w,Fe=oe(ie,Ae,e,s),$e=oe(ne,xe,e,s);return Fe<$e?[ie,Ae]:[ne,xe]}}const L=class L extends f{constructor(){super();l(this,"isMouseDown");l(this,"isMouseMove");l(this,"isGhostCircle");l(this,"tempCircleElem");l(this,"tempCenterElem");l(this,"tempPElem");this.isMouseDown=!1,this.isMouseMove=!1,this.tempCircleElem=null,this.tempCenterElem=null,this.tempPElem=null,this.isGhostCircle=!1}static getInstance(){return L.instance||(L.instance=new L,r.instance.set("circle",L.instance)),L.instance}drawCircleNoParam(){r.instance.setCurrentCommand(L.instance)}drawCircleWithPoints(e,s){new le(e,s,null)}drawCircleWithPointsWithLabel(e,s,i){new le(e,s,i)}execute(e){e.length==2&&e[0]instanceof m&&e[1]instanceof m?this.drawCircleWithPoints(e[0],e[1]):e.length==3&&e[0]instanceof m&&e[1]instanceof m&&typeof e[2]=="string"?this.drawCircleWithPointsWithLabel(e[0],e[1],e[2]):this.drawCircleNoParam()}onmousedown(e){const[s,i]=p(e);if(this.tempCircleElem==null){this.isMouseDown=!0;let n=g.instance.find(s,i);n==null&&(n=new m(s,i,null,{}),this.tempCenterElem=n);const a=new m(s,i,null,{isGhost:!0});a.setIsGhost(!0),this.tempPElem=a,h.instance.select(n),this.tempCircleElem=new le(n,a,null)}else{let n=g.instance.find(s,i);const a=this.tempCircleElem.getP();n==null?(a.move(s,i),a.setIsGhost(!1),this.tempCircleElem.updateEquation()):(this.tempCircleElem.setP(n),a.remove()),this.isGhostCircle=!1,this.tempCircleElem=null,this.tempCenterElem=null,this.tempPElem=null,h.instance.unselect()}}onmousemove(e){if((this.isMouseDown||this.isGhostCircle)&&this.tempCircleElem!=null){const s=this.tempCircleElem.getP(),[i,n]=p(e);s.move(i,n)}this.isMouseDown&&(this.isMouseMove=!0)}onmouseup(e){const[s,i]=p(e);if(this.isMouseDown)if(this.isMouseDown=!1,this.isMouseMove){if(this.isMouseMove=!1,this.tempCircleElem!=null){let n=g.instance.find(s,i);const a=this.tempCircleElem.getP();n==null?(a.setIsGhost(!1),this.tempCircleElem.updateEquation()):(this.tempCircleElem.setP(n),a.remove()),this.tempCircleElem=null,this.tempCenterElem=null,this.tempPElem=null,h.instance.unselect()}}else this.isGhostCircle=!0}onleave(){var e,s;this.tempCircleElem!=null&&(this.tempCircleElem.remove(),(e=this.tempCenterElem)==null||e.remove(),(s=this.tempPElem)==null||s.remove())}};l(L,"instance");let ue=L;const Y=class Y extends f{constructor(){super()}static getInstance(){return Y.instance||(Y.instance=new Y,r.instance.set("fullscreen",Y.instance)),Y.instance}execute(t){if(!document.fullscreenElement){const e=document.getElementById("body");if(e==null)return;e.requestFullscreen()}}};l(Y,"instance");let me=Y;const k=class k extends f{constructor(){super()}static getInstance(){return k.instance||(k.instance=new k,r.instance.set("hide",k.instance)),k.instance}hideElemNoParam(){r.instance.setCurrentCommand(k.instance)}execute(t){t.length==1&&t[0]instanceof U?t[0].hide():this.hideElemNoParam()}onmousedown(t){const[e,s]=p(t);let i=g.instance.find(e,s);i!=null&&i.getIsShow()&&i.hide()}};l(k,"instance");let fe=k;const S=class S extends f{constructor(){super()}static getInstance(){return S.instance||(S.instance=new S,r.instance.set("hideLabel",S.instance)),S.instance}hideLabelNoParam(){r.instance.setCurrentCommand(S.instance)}execute(t){t.length==0?this.hideLabelNoParam():t.length==1&&t[0]instanceof I&&t[0].hideLabel()}onmousedown(t){const[e,s]=p(t);let i=g.instance.find(e,s);i!=null&&i.getIsShow()&&i.hideLabel()}};l(S,"instance");let de=S;const T=class T extends f{constructor(){super()}static getInstance(){return T.instance||(T.instance=new T,r.instance.set("unshowTrack",T.instance)),T.instance}execute(t){t.length==1&&t[0]instanceof U&&t[0].unshowTrack()}};l(T,"instance");let ge=T;class et extends We{constructor(e,s,i,n){const a=Ye(e,s,i,n),c=Te(e,s,i,n);super(a,c);l(this,"m");l(this,"b");this.m=(s-n)/(e-i),this.b=n-(s-n)*i/(e-i)}getM(){return this.m}getB(){return this.b}update(e,s,i,n){this.setEquation(Ye(e,s,i,n)),this.setDistanceEquation(Te(e,s,i,n)),this.m=(s-n)/(e-i),this.b=n-(s-n)*i/(e-i)}}class ee extends se{constructor(e,s,i){const n=`M ${e.getX()} ${e.getY()} L ${s.getX()} ${s.getY()}`,a=j("path");a.setAttribute("d",n);const c=new et(e.getX(),e.getY(),s.getX(),s.getY());super(a,c,"red",e.getX(),e.getY(),i,!1,b.Curve);l(this,"d");l(this,"startPoint");l(this,"endPoint");l(this,"equation");this.equation=c,this.d=n,this.startPoint=e,this.endPoint=s,this.startPoint.onMove(u=>{this.move()}),this.startPoint.onLeaveCallback(()=>{this.remove()}),this.endPoint.onMove(u=>{this.move()}),this.endPoint.onLeaveCallback(()=>{this.remove()})}updateEquation(){this.equation.update(this.startPoint.getX(),this.startPoint.getY(),this.endPoint.getX(),this.endPoint.getY())}move(){const e=this.startPoint.getX(),s=this.startPoint.getY(),i=this.endPoint.getX(),n=this.endPoint.getY();this.d=`M ${e} ${s} L ${i} ${n}`,this.elem.setAttribute("d",this.d),this.updateEquation();for(const a of this.onMoveCallbacks)a(this)}getElem(){return this.elem}getEndPoint(){return this.endPoint}setEndPoint(e){this.endPoint=e,this.move(),this.endPoint.onMove(s=>{this.move()}),this.updateEquation()}remove(){this.removeLabel(),this.elem.remove()}onmousedown(e){}onmousemove(e){}getFoot(e,s){const i=this.equation.getM(),n=this.equation.getB(),a=1/i,u=(s-a*e-n)/(i-a),d=i*u+n;return[u,d]}getRatio(e,s){return this.endPoint.getX()==this.startPoint.getX()?0:(e-this.startPoint.getX())/(this.endPoint.getX()-this.startPoint.getX())}getPointByRatio(e){return[(this.endPoint.getX()-this.startPoint.getX())*e+this.startPoint.getX(),(this.endPoint.getY()-this.startPoint.getY())*e+this.startPoint.getY()]}}const C=class C extends f{constructor(){super();l(this,"isMouseDown");l(this,"isMouseMove");l(this,"isGhostLine");l(this,"tempLineElem");l(this,"tempStartPointElem");l(this,"tempEndPointElem");this.isMouseDown=!1,this.isMouseMove=!1,this.tempLineElem=null,this.tempStartPointElem=null,this.tempEndPointElem=null,this.isGhostLine=!1}static getInstance(){return C.instance||(C.instance=new C,r.instance.set("line",C.instance)),C.instance}drawLineNoParam(){r.instance.setCurrentCommand(C.instance)}drawLineWithPoints(e,s){new ee(e,s,null)}drawLineWithPointsWithLabel(e,s,i){new ee(e,s,i)}execute(e){e.length==2&&e[0]instanceof m&&e[1]instanceof m?this.drawLineWithPoints(e[0],e[1]):e.length==3&&e[0]instanceof m&&e[1]instanceof m&&typeof e[2]=="string"?this.drawLineWithPointsWithLabel(e[0],e[1],e[2]):this.drawLineNoParam()}onmousedown(e){const[s,i]=p(e);if(this.tempLineElem==null){this.isMouseDown=!0;let n=g.instance.find(s,i);n==null&&(n=new m(s,i,null,{}),this.tempStartPointElem=n);const a=new m(s,i,null,{isGhost:!0});a.setIsGhost(!0),this.tempEndPointElem=a,h.instance.select(n),this.tempLineElem=new ee(n,a,null)}else{let n=g.instance.find(s,i);const a=this.tempLineElem.getEndPoint();n==null?(a.move(s,i),a.setIsGhost(!1),this.tempLineElem.updateEquation()):(this.tempLineElem.setEndPoint(n),a.remove()),this.isGhostLine=!1,this.tempLineElem=null,this.tempStartPointElem=null,this.tempEndPointElem=null,h.instance.unselect()}}onmousemove(e){if((this.isMouseDown||this.isGhostLine)&&this.tempLineElem!=null){const s=this.tempLineElem.getEndPoint(),[i,n]=p(e);s.move(i,n)}this.isMouseDown&&(this.isMouseMove=!0)}onmouseup(e){const[s,i]=p(e);if(this.isMouseDown)if(this.isMouseDown=!1,this.isMouseMove){if(this.isMouseMove=!1,this.tempLineElem!=null){let n=g.instance.find(s,i);const a=this.tempLineElem.getEndPoint();n==null?(a.setIsGhost(!1),this.tempLineElem.updateEquation()):(this.tempLineElem.setEndPoint(n),a.remove()),this.tempLineElem=null,this.tempStartPointElem=null,this.tempEndPointElem=null,h.instance.unselect()}}else this.isGhostLine=!0}onleave(){var e,s;this.tempLineElem!=null&&(this.tempLineElem.remove(),(e=this.tempStartPointElem)==null||e.remove(),(s=this.tempEndPointElem)==null||s.remove())}};l(C,"instance");let be=C;const N=class N extends f{constructor(){super()}static getInstance(){return N.instance||(N.instance=new N,r.instance.set("lock",N.instance)),N.instance}execute(t){t.length==1&&t[0]instanceof m&&t[0].lock()}};l(N,"instance");let pe=N;const H=class H{constructor(){l(this,"actionStack");l(this,"backwardActionStack");this.actionStack=[],this.backwardActionStack=[]}static getInstance(){return H.instance||(H.instance=new H),H.instance}push(t){if(this.actionStack.push(t),this.backwardActionStack.length>0)for(const e of this.backwardActionStack)e.clean()}reverse(){const t=this.actionStack.pop();t&&(t.reverse(),this.backwardActionStack.push(t))}backward(){const t=this.backwardActionStack.pop();t&&(t.backward(),this.actionStack.push(t))}};l(H,"instance");let te=H;class Ge{constructor(t){l(this,"elem");this.elem=t}reverse(){this.elem.reverse()}backward(){this.elem.backward()}clean(){this.elem.remove()}}class Be extends m{constructor(e,s,i,n,a){super(e,s,i,a);l(this,"curveElem");this.curveElem=n}onmousemove(e){if(!this.isLock){const[s,i]=this.curveElem.getFoot(globalThis.mouseX,globalThis.mouseY);this.move(s,i)}}}class tt extends Be{constructor(e,s,i,n,a){super(e,s,i,n,a);l(this,"ratio");this.ratio=n.getRatio(e,s),n.onMove(c=>{const[u,d]=n.getPointByRatio(this.ratio);this.move(u,d)})}onmousemove(e){if(!this.isLock){const[s,i]=this.curveElem.getFoot(globalThis.mouseX,globalThis.mouseY);this.curveElem instanceof ee&&(this.ratio=this.curveElem.getRatio(s,i)),this.move(s,i)}}}const P=class P extends f{constructor(){super();l(this,"isMouseDown");this.isMouseDown=!1}static getInstance(){return P.instance||(P.instance=new P,r.instance.set("point",P.instance)),P.instance}drawPointNoParam(){r.instance.setCurrentCommand(P.instance)}drawPointWithCoor(e,s){new m(e,s,null,{})}drawPointWithCoorAndLabel(e,s,i){new m(e,s,i,{})}execute(e){e.length==2&&typeof e[0]=="number"&&typeof e[1]=="number"?this.drawPointWithCoor(e[0],e[1]):e.length==3&&typeof e[0]=="number"&&typeof e[1]=="number"&&typeof e[2]=="string"?this.drawPointWithCoorAndLabel(e[0],e[1],e[2]):this.drawPointNoParam()}onmousedown(e){this.isMouseDown=!0;const[s,i]=p(e);let n=g.instance.find(s,i);if(n!=null){h.instance.select(n);return}let a=Q.instance.find(s,i);if(a!=null){a instanceof ee?n=new tt(s,i,null,a,{}):n=new Be(s,i,null,a,{}),te.instance.push(new Ge(n)),h.instance.select(n);return}n=new m(s,i,null,{}),te.instance.push(new Ge(n)),h.instance.select(n)}onmousemove(e){if(this.isMouseDown){const s=h.instance.getSelectedElem();s instanceof m&&s.onmousemove(e)}}onmouseup(e){this.isMouseDown=!1,h.instance.unselect()}onleave(){r.instance.setDefaultCommand()}};l(P,"instance");let we=P;const D=class D extends f{constructor(){super()}static getInstance(){return D.instance||(D.instance=new D,r.instance.set("remove",D.instance)),D.instance}execute(t){t.length==1&&t[0]instanceof U&&t[0].remove()}};l(D,"instance");let Ee=D;const G=class G extends f{constructor(){super()}static getInstance(){return G.instance||(G.instance=new G,r.instance.set("show",G.instance)),G.instance}execute(t){t.length==1&&t[0]instanceof U&&t[0].show()}};l(G,"instance");let ve=G;const M=class M extends f{constructor(){super()}static getInstance(){return M.instance||(M.instance=new M,r.instance.set("showLabel",M.instance)),M.instance}showLabelNoParam(){r.instance.setCurrentCommand(M.instance)}execute(t){t.length==0?this.showLabelNoParam():t.length==1&&t[0]instanceof I&&t[0].showLabel()}onmousedown(t){const[e,s]=p(t);let i=g.instance.find(e,s);i!=null&&i.getIsShow()&&i.showLabel()}};l(M,"instance");let Le=M;const W=class W extends f{constructor(){super()}static getInstance(){return W.instance||(W.instance=new W,r.instance.set("showTrack",W.instance)),W.instance}execute(t){t.length==1&&t[0]instanceof U&&t[0].showTrack()}};l(W,"instance");let ke=W;const B=class B extends f{constructor(){super()}static getInstance(){return B.instance||(B.instance=new B,r.instance.set("unlock",B.instance)),B.instance}execute(t){t.length==1&&t[0]instanceof m&&t[0].unlock()}};l(B,"instance");let Se=B;const F=class F extends f{constructor(){super()}static getInstance(){return F.instance||(F.instance=new F,r.instance.set("cleanTrack",F.instance)),F.instance}execute(t){t.length==0&&document.querySelectorAll(".track").forEach(e=>e.remove())}};l(F,"instance");let Ce=F;const st=()=>{r.getInstance(),_.getInstance(),we.getInstance(),be.getInstance(),ue.getInstance(),fe.getInstance(),ve.getInstance(),me.getInstance(),Ee.getInstance(),de.getInstance(),Le.getInstance(),re.getInstance(),he.getInstance(),ae.getInstance(),ce.getInstance(),pe.getInstance(),Se.getInstance(),ke.getInstance(),ge.getInstance(),Ce.getInstance(),r.instance.setCurrentCommand(_.instance)},it=o=>{const t=o.trim().split("(");if(t.length!=2)return;const e=t[0].trim(),s=t[1].slice(0,-1).trim().split(",").map(n=>n.trim()).map(n=>{if(n=="")return null;if(n[0]=="'"&&n[n.length-1]=="'"||n[0]=='"'&&n[n.length-1]=='"')return n.slice(1,-1);if(isNaN(parseFloat(n))){const a=h.instance.getByLabel(n);return a??n}else return Number(n)}).filter(n=>n!=null),i=r.instance.get(e);i!=null&&i.execute(s)},nt=new Map([["gm","mouse"],["gp","point"],["gl","line"],["gc","circle"]]),K=class K{constructor(){l(this,"isshow");l(this,"elem");l(this,"text");l(this,"resultElems");l(this,"resultElemChooseIndex");this.isshow=!1,this.elem=document.getElementById("search-command-box"),this.text="",this.resultElems=[],this.resultElemChooseIndex=0}static getInstance(){return K.instance||(K.instance=new K),K.instance}getResultElems(){return this.resultElems}show(){this.isshow||(this.isshow=!0,this.elem!=null&&this.elem.classList.remove("hide"))}hide(){this.isshow&&(this.isshow=!1,this.elem!=null&&(this.elem.classList.add("hide"),this.clean()))}clean(){this.elem!=null&&(this.elem.replaceChildren(),this.text="",this.resultElemChooseIndex=0)}search(){const t=r.instance.search(this.text);if(t.length==0){this.hide();return}const e=t.length<5?t.length:5;if(this.elem!=null){this.elem.replaceChildren(),this.resultElems=[];for(let s=0;s<e;s++){const i=document.createElement("div");i.classList.add("search-result"),i.onmousedown=n=>{n.preventDefault(),this.choose(s)},i.innerHTML=t[s],s==this.resultElemChooseIndex&&i.classList.add("search-result-choose"),this.elem.appendChild(i),this.resultElems.push(i)}}}tab(){this.resultElems.length>0&&(J.instance.setValue(this.resultElems[this.resultElemChooseIndex].innerHTML),this.hide())}setText(t){this.text=t,this.search()}moveUp(){this.resultElems[this.resultElemChooseIndex].classList.remove("search-result-choose"),this.resultElemChooseIndex==0?this.resultElemChooseIndex=this.resultElems.length-1:this.resultElemChooseIndex--,this.resultElems[this.resultElemChooseIndex].classList.add("search-result-choose")}moveDown(){this.resultElems[this.resultElemChooseIndex].classList.remove("search-result-choose"),this.resultElemChooseIndex==this.resultElems.length-1?this.resultElemChooseIndex=0:this.resultElemChooseIndex++,this.resultElems[this.resultElemChooseIndex].classList.add("search-result-choose")}choose(t){t<this.resultElems.length&&(J.instance.setValue(this.resultElems[t].innerHTML),this.hide())}};l(K,"instance");let v=K;const z=class z{constructor(){l(this,"isShow");l(this,"elem");this.isShow=!1,this.elem=document.getElementById("command"),v.getInstance(),this.elem!=null&&(this.elem.onblur=t=>{this.hide()},this.elem.onkeydown=t=>{if(t.stopPropagation(),t.key=="Enter")if(r.instance.search(this.getValue()).length>0){const e=v.instance.tab();e!=null&&this.elem!=null&&(this.elem.value=e)}else it(this.getValue()),this.hide();else if(t.key=="Escape")this.hide();else if(t.key=="Tab"){t.preventDefault();const e=v.instance.tab();e!=null&&this.elem!=null&&(this.elem.value=e)}else t.key=="ArrowUp"?v.instance.moveUp():t.key=="ArrowDown"&&v.instance.moveDown()},this.elem.oninput=t=>{v.instance.show(),v.instance.setText(this.getValue())})}static getInstance(){return z.instance||(z.instance=new z),z.instance}focus(){this.elem!=null&&this.elem.focus()}show(){this.isShow||(this.isShow=!0,this.elem!=null&&this.elem.classList.remove("hide"))}hide(){this.isShow&&(this.isShow=!1,this.elem!=null&&(this.elem.classList.add("hide"),this.elem.value=""),v.instance.hide())}getValue(){return this.elem!=null?this.elem.value:""}setValue(t){this.elem!=null&&(this.elem.value=t)}};l(z,"instance");let J=z;window.onload=o=>{globalThis.nextId=1,globalThis.nextPointLabelChar="A",globalThis.nextPointLabelNum=0,globalThis.nextCurveLabelChar="a",globalThis.nextCurveLabelNum=0,globalThis.unusedPointLabels=[],globalThis.unusedCurveLabels=[],globalThis.coorCenterX=0,globalThis.coorCenterY=0;const t=te.getInstance(),e=document.getElementById("main");if(e==null)return;globalThis.mainLeftMargin=e.getBoundingClientRect().x;const s=new He(e.offsetWidth,e.offsetHeight);e.appendChild(s.getElem()),window.onresize=n=>{s.setWidth(e.offsetWidth),s.setHeight(e.offsetHeight)},h.getInstance(s.getElem()),g.getInstance(),Q.getInstance(),st(),document.getElementById("search-command-box")!=null&&(e.onmousedown=n=>{globalThis.currentShortcut="",r.instance.getCurrentCommand().onmousedown(n)},e.onmousemove=n=>{const[a,c]=p(n);globalThis.mouseX=a,globalThis.mouseY=c,r.instance.getCurrentCommand().onmousemove(n)},e.onmouseup=n=>{r.instance.getCurrentCommand().onmouseup(n)},document.onkeydown=n=>{n.ctrlKey&&n.key=="z"?t.reverse():n.ctrlKey&&n.key=="y"&&t.backward()},J.getInstance(),document.onkeyup=n=>{if(n.key=="/")J.instance.show(),J.instance.focus(),r.instance.getCurrentCommand().onleave(),h.instance.unselect(),r.instance.setDefaultCommand();else if(n.key=="g")globalThis.currentShortcut="g";else{const a=nt.get(globalThis.currentShortcut+n.key);if(a!=null){const c=r.instance.get(a);c!=null&&(globalThis.currentShortcut="",r.instance.getCurrentCommand().onleave(),h.instance.unselect(),r.instance.setCurrentCommand(c))}}},window.onbeforeunload=()=>{})};
